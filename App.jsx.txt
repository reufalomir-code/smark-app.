import React, { useState, useMemo } from 'react';
import { 
  Scale, 
  Building2, 
  Gavel, 
  FileCheck, 
  RefreshCw, 
  ChevronLeft, 
  Briefcase, 
  FileX, 
  ScrollText, 
  ShieldAlert,
  Wallet,
  BadgePercent,
  TrendingUp,
  UserCheck,
  Ban,
  FileSignature,
  PenTool,
  HelpCircle,
  Check,
  ArrowRight,
  MonitorCheck,
  AlertOctagon,
  FileSearch,
  CheckCircle2,
  XCircle,
  ArrowLeftRight,
  FileText,
  List,
  BookOpen
} from 'lucide-react';

// --- قاعدة البيانات الهرمية الكاملة (100 تصنيف) ---
const CLAIMS_DB = [
  // ================= حقوق وظيفية =================
  { id: 1, main: 'حقوق وظيفية', sub: 'الرواتب والمكافآت', claim: 'المطالبة بالرواتب الشهرية المتأخرة', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام (أداء حق)' },
  { id: 2, main: 'حقوق وظيفية', sub: 'الرواتب والمكافآت', claim: 'فروقات الترقية بأثر رجعي', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 3, main: 'حقوق وظيفية', sub: 'الرواتب والمكافآت', claim: 'مكافأة نهاية الخدمة (مدني)', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 4, main: 'حقوق وظيفية', sub: 'الرواتب والمكافآت', claim: 'مكافأة نهاية الخدمة (عسكري)', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 33, main: 'حقوق وظيفية', sub: 'الرواتب والمكافآت', claim: 'صرف العلاوة السنوية', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 5, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل الترحيل', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 6, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل التعيين', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 7, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل النقل', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 8, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل السكن', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 9, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل الانتداب الداخلي', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 10, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل الانتداب الخارجي', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 11, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل الخطر', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 12, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل العدوى', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 13, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل المناطق النائية', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 14, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل الضرر', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 15, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل طبيعة عمل', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 16, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل الحاسب الآلي', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 17, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل الأمن والسلامة', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 18, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل الميدان (عسكري)', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 19, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل الإعاشة (عسكري)', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 20, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل السترة/الملابس (عسكري)', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 21, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل مكافحة الإرهاب', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 22, main: 'حقوق وظيفية', sub: 'البدلات والمزايا', claim: 'بدل يومية الميدان', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 23, main: 'حقوق وظيفية', sub: 'تعويضات ومصاريف', claim: 'مكافأة خارج دوام', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 24, main: 'حقوق وظيفية', sub: 'تعويضات ومصاريف', claim: 'مكافأة العمل أيام العطل', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 25, main: 'حقوق وظيفية', sub: 'تعويضات ومصاريف', claim: 'التعويض عن رصيد الإجازات العادية', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 26, main: 'حقوق وظيفية', sub: 'تعويضات ومصاريف', claim: 'التعويض عن الإجازات الاضطرارية', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 27, main: 'حقوق وظيفية', sub: 'تعويضات ومصاريف', claim: 'مصاريف الابتعاث الدراسي', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 28, main: 'حقوق وظيفية', sub: 'تعويضات ومصاريف', claim: 'تذاكر السفر', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 29, main: 'حقوق وظيفية', sub: 'تعويضات ومصاريف', claim: 'رسوم تعليم الأبناء (للموفدين)', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'إلزام' },
  { id: 35, main: 'حقوق وظيفية', sub: 'تعويضات ومصاريف', claim: 'تعويض إصابة عمل', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'تعويض وظيفي' },
  { id: 30, main: 'حقوق وظيفية', sub: 'تسوية الوضع والتقاعد', claim: 'احتساب خدمة بند الأجور', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'تسوية وضع' },
  { id: 31, main: 'حقوق وظيفية', sub: 'تسوية الوضع والتقاعد', claim: 'ضم الخدمات للتقاعد', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'تسوية وضع' },
  { id: 32, main: 'حقوق وظيفية', sub: 'تسوية الوضع والتقاعد', claim: 'تسوية المعاش التقاعدي', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'تسوية وضع' },
  { id: 34, main: 'حقوق وظيفية', sub: 'تسوية الوضع والتقاعد', claim: 'تعديل تاريخ التعيين/المباشرة', basis: 'مادة 13/أ', circuit: 'الدوائر الإدارية (شؤون موظفين)', remedy: 'تسوية وضع' },

  // ================= إلغاء القرارات =================
  { id: 36, main: 'إلغاء قرارات إدارية', sub: 'إنهاء الخدمة والفصل', claim: 'إلغاء إنهاء خدمة (للمصلحة العامة)', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 37, main: 'إلغاء قرارات إدارية', sub: 'إنهاء الخدمة والفصل', claim: 'إلغاء فصل (بسبب الغياب)', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 38, main: 'إلغاء قرارات إدارية', sub: 'إنهاء الخدمة والفصل', claim: 'إلغاء فصل تأديبي', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 39, main: 'إلغاء قرارات إدارية', sub: 'إنهاء الخدمة والفصل', claim: 'إلغاء طي قيد (فترة تجربة)', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 42, main: 'إلغاء قرارات إدارية', sub: 'إنهاء الخدمة والفصل', claim: 'إلغاء كف يد', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 48, main: 'إلغاء قرارات إدارية', sub: 'إنهاء الخدمة والفصل', claim: 'إلغاء رفض استقالة', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 40, main: 'إلغاء قرارات إدارية', sub: 'النقل والتقييم والعقوبات', claim: 'إلغاء نقل مكاني (تعسفي)', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 41, main: 'إلغاء قرارات إدارية', sub: 'النقل والتقييم والعقوبات', claim: 'إلغاء نقل نوعي (تغيير مسمى)', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 43, main: 'إلغاء قرارات إدارية', sub: 'النقل والتقييم والعقوبات', claim: 'إلغاء حرمان من علاوة', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 44, main: 'إلغاء قرارات إدارية', sub: 'النقل والتقييم والعقوبات', claim: 'إلغاء حرمان من ترقية', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 45, main: 'إلغاء قرارات إدارية', sub: 'النقل والتقييم والعقوبات', claim: 'إلغاء تقويم أداء وظيفي', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 46, main: 'إلغاء قرارات إدارية', sub: 'النقل والتقييم والعقوبات', claim: 'إلغاء حسم من الراتب', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 47, main: 'إلغاء قرارات إدارية', sub: 'النقل والتقييم والعقوبات', claim: 'إلغاء عقوبة لوم/إنذار', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 49, main: 'إلغاء قرارات إدارية', sub: 'النقل والتقييم والعقوبات', claim: 'إلغاء رفض إجازة', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 50, main: 'إلغاء قرارات إدارية', sub: 'التراخيص والخدمات والملكية', claim: 'إلغاء نزع ملكية', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 51, main: 'إلغاء قرارات إدارية', sub: 'التراخيص والخدمات والملكية', claim: 'إلغاء رفض رخصة بناء', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 52, main: 'إلغاء قرارات إدارية', sub: 'التراخيص والخدمات والملكية', claim: 'إلغاء رفض سجل تجاري', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 53, main: 'إلغاء قرارات إدارية', sub: 'التراخيص والخدمات والملكية', claim: 'إلغاء قرار إغلاق محل', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 54, main: 'إلغاء قرارات إدارية', sub: 'التراخيص والخدمات والملكية', claim: 'إلغاء سحب ترخيص مهني', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 55, main: 'إلغاء قرارات إدارية', sub: 'التراخيص والخدمات والملكية', claim: 'إلغاء غرامة بلدية', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 56, main: 'إلغاء قرارات إدارية', sub: 'التراخيص والخدمات والملكية', claim: 'إلغاء غرامة وزارة العمل', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 57, main: 'إلغاء قرارات إدارية', sub: 'التراخيص والخدمات والملكية', claim: 'إلغاء منع من السفر', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 58, main: 'إلغاء قرارات إدارية', sub: 'التراخيص والخدمات والملكية', claim: 'إلغاء إيقاف خدمات', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 64, main: 'إلغاء قرارات إدارية', sub: 'التراخيص والخدمات والملكية', claim: 'إلغاء قرار سلبي (امتناع تنفيذ حكم)', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 65, main: 'إلغاء قرارات إدارية', sub: 'التراخيص والخدمات والملكية', claim: 'إلغاء قرار سلبي (امتناع إصدار قرار)', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 59, main: 'إلغاء قرارات إدارية', sub: 'شؤون الأجانب والإقامة', claim: 'إلغاء قرار ترحيل', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 60, main: 'إلغاء قرارات إدارية', sub: 'شؤون الأجانب والإقامة', claim: 'إلغاء منع دخول المملكة', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 61, main: 'إلغاء قرارات إدارية', sub: 'شؤون الأجانب والإقامة', claim: 'إلغاء رفض تجديد إقامة', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 62, main: 'إلغاء قرارات إدارية', sub: 'شؤون الأجانب والإقامة', claim: 'إلغاء رفض نقل كفالة', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },
  { id: 63, main: 'إلغاء قرارات إدارية', sub: 'شؤون الأجانب والإقامة', claim: 'إلغاء تعديل مهنة', basis: 'مادة 13/ب', circuit: 'الدوائر الإدارية (إلغاء)', remedy: 'إلغاء' },

  // ================= عقود إدارية =================
  { id: 66, main: 'عقود إدارية', sub: 'مستحقات مالية ومستخلصات', claim: 'صرف مستخلص ختامي', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 67, main: 'عقود إدارية', sub: 'مستحقات مالية ومستخلصات', claim: 'صرف مستخلصات جارية', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 72, main: 'عقود إدارية', sub: 'مستحقات مالية ومستخلصات', claim: 'قيمة أعمال إضافية', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 74, main: 'عقود إدارية', sub: 'مستحقات مالية ومستخلصات', claim: 'فروقات أسعار المواد', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 75, main: 'عقود إدارية', sub: 'مستحقات مالية ومستخلصات', claim: 'مطالبة عقد توريد', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 76, main: 'عقود إدارية', sub: 'مستحقات مالية ومستخلصات', claim: 'مطالبة عقد صيانة وتشغيل', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 77, main: 'عقود إدارية', sub: 'مستحقات مالية ومستخلصات', claim: 'مطالبة عقد إعاشة', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 78, main: 'عقود إدارية', sub: 'مستحقات مالية ومستخلصات', claim: 'مطالبة إيجار (الحكومة مستأجر)', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 83, main: 'عقود إدارية', sub: 'مستحقات مالية ومستخلصات', claim: 'أتعاب استشارات هندسية', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 85, main: 'عقود إدارية', sub: 'مستحقات مالية ومستخلصات', claim: 'استرداد مدفوعات زائدة', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 68, main: 'عقود إدارية', sub: 'غرامات وضمانات', claim: 'إفراج عن ضمان نهائي', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 69, main: 'عقود إدارية', sub: 'غرامات وضمانات', claim: 'إفراج عن محجوز ضمان', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 70, main: 'عقود إدارية', sub: 'غرامات وضمانات', claim: 'استرداد غرامة تأخير', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 71, main: 'عقود إدارية', sub: 'غرامات وضمانات', claim: 'استرداد غرامة إشراف', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 81, main: 'عقود إدارية', sub: 'غرامات وضمانات', claim: 'طعن في مصادرة الضمان', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 84, main: 'عقود إدارية', sub: 'غرامات وضمانات', claim: 'فوائد تأخيرية', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 73, main: 'عقود إدارية', sub: 'فسخ وسحب وتعويض', claim: 'تعويض تمديد مدة مشروع', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },
  { id: 79, main: 'عقود إدارية', sub: 'فسخ وسحب وتعويض', claim: 'فسخ العقد والتعويض', basis: 'مادة 13/d', circuit: 'الدوائر الإدارية (عقود)', remedy: 'فسخ/تعويض' },
  { id: 80, main: 'عقود إدارية', sub: 'فسخ وسحب وتعويض', claim: 'طعن في سحب العمل', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'إلغاء/قضاء كامل' },
  { id: 82, main: 'عقود إدارية', sub: 'فسخ وسحب وتعويض', claim: 'نزاع عقد امتياز', basis: 'مادة 13/د', circuit: 'الدوائر الإدارية (عقود)', remedy: 'قضاء كامل' },

  // ================= مسؤولية تقصيرية (تعويض) =================
  { id: 86, main: 'مسؤولية تقصيرية (تعويض)', sub: 'أخطاء جهات وموظفين', claim: 'تعويض عن سجن زائد المدة', basis: 'مادة 13/ج', circuit: 'الدوائر الإدارية (تعويض)', remedy: 'تعويض' },
  { id: 87, main: 'مسؤولية تقصيرية (تعويض)', sub: 'أخطاء جهات وموظفين', claim: 'تعويض سجن لعدم الإدانة', basis: 'مادة 13/ج', circuit: 'الدوائر الإدارية (تعويض)', remedy: 'تعويض' },
  { id: 88, main: 'مسؤولية تقصيرية (تعويض)', sub: 'أخطاء جهات وموظفين', claim: 'خطأ طبي (مستشفى حكومي)', basis: 'مادة 13/ج', circuit: 'الدوائر الإدارية (تعويض)', remedy: 'تعويض' },
  { id: 92, main: 'مسؤولية تقصيرية (تعويض)', sub: 'أخطاء جهات وموظفين', claim: 'فقدان وثائق رسمية', basis: 'مادة 13/ج', circuit: 'الدوائر الإدارية (تعويض)', remedy: 'تعويض' },
  { id: 89, main: 'مسؤولية تقصيرية (تعويض)', sub: 'أضرار الممتلكات', claim: 'أضرار حفر الطرق', basis: 'مادة 13/ج', circuit: 'الدوائر الإدارية (تعويض)', remedy: 'تعويض' },
  { id: 90, main: 'مسؤولية تقصيرية (تعويض)', sub: 'أضرار الممتلكات', claim: 'أضرار السيول', basis: 'مادة 13/ج', circuit: 'الدوائر الإدارية (تعويض)', remedy: 'تعويض' },
  { id: 91, main: 'مسؤولية تقصيرية (تعويض)', sub: 'أضرار الممتلكات', claim: 'اعتداء مادي على عقار', basis: 'مادة 13/ج', circuit: 'الدوائر الإدارية (تعويض)', remedy: 'تعويض' },

  // ================= تأديبية =================
  { id: 93, main: 'دعوى تأديبية', sub: 'جرائم الوظيفة العامة', claim: 'جريمة الرشوة', basis: 'مادة 13/هـ', circuit: 'الدوائر الجزائية (تأديب)', remedy: 'إدانة وعقوبة' },
  { id: 94, main: 'دعوى تأديبية', sub: 'جرائم الوظيفة العامة', claim: 'تزوير محررات رسمية', basis: 'مادة 13/هـ', circuit: 'الدوائر الجزائية (تأديب)', remedy: 'إدانة وعقوبة' },
  { id: 95, main: 'دعوى تأديبية', sub: 'جرائم الوظيفة العامة', claim: 'تزوير ذو صلة بالوظيفة', basis: 'مادة 13/هـ', circuit: 'الدوائر الجزائية (تأديب)', remedy: 'إدانة وعقوبة' },
  { id: 96, main: 'دعوى تأديبية', sub: 'جرائم الوظيفة العامة', claim: 'اختلاس مال عام', basis: 'مادة 13/هـ', circuit: 'الدوائر الجزائية (تأديب)', remedy: 'إدانة وعقوبة' },
  { id: 97, main: 'دعوى تأديبية', sub: 'جرائم الوظيفة العامة', claim: 'تبديد مال عام', basis: 'مادة 13/هـ', circuit: 'الدوائر الجزائية (تأديب)', remedy: 'إدانة وعقوبة' },
  { id: 98, main: 'دعوى تأديبية', sub: 'جرائم الوظيفة العامة', claim: 'استغلال نفوذ وظيفي', basis: 'مادة 13/هـ', circuit: 'الدوائر الجزائية (تأديب)', remedy: 'إدانة وعقوبة' },
  { id: 99, main: 'دعوى تأديبية', sub: 'جرائم الوظيفة العامة', claim: 'اشتغال بالتجارة', basis: 'مادة 13/هـ', circuit: 'الدوائر الجزائية (تأديب)', remedy: 'إدانة وعقوبة' },
  { id: 100, main: 'دعوى تأديبية', sub: 'جرائم الوظيفة العامة', claim: 'سوء استعمال إداري', basis: 'مادة 13/هـ', circuit: 'الدوائر الجزائية (تأديب)', remedy: 'إدانة وعقوبة' },
];

const App = () => {
  // Views: 'beneficiary' or 'operations'
  const [view, setView] = useState('beneficiary');

  // States for Beneficiary Flow
  const [step, setStep] = useState(1);
  const [selectedMain, setSelectedMain] = useState(null);
  const [selectedSub, setSelectedSub] = useState(null);
  const [selectedClaim, setSelectedClaim] = useState(null);
  const [customClaimText, setCustomClaimText] = useState(''); // Used for "Other" flow primarily
  
  // New States for Detailed Form (Step 4)
  const [caseSubject, setCaseSubject] = useState('');
  const [caseRequests, setCaseRequests] = useState('');
  const [caseGrounds, setCaseGrounds] = useState('');

  const [isProcessing, setIsProcessing] = useState(false);

  // States for Operations Flow
  const [opStep, setOpStep] = useState('dashboard'); 
  const [selectedCase, setSelectedCase] = useState(null);

  // Helper Functions
  const mainCategories = useMemo(() => {
    return [...new Set(CLAIMS_DB.map(item => item.main))];
  }, []);

  const subCategories = useMemo(() => {
    if (!selectedMain || selectedMain === 'أخرى') return [];
    return [...new Set(CLAIMS_DB.filter(item => item.main === selectedMain).map(item => item.sub))];
  }, [selectedMain]);

  const specificClaims = useMemo(() => {
    if (!selectedMain || !selectedSub) return [];
    return CLAIMS_DB.filter(item => item.main === selectedMain && item.sub === selectedSub);
  }, [selectedMain, selectedSub]);

  // Handlers for Beneficiary
  const handleMainSelect = (category) => {
    setSelectedMain(category);
    setStep(2);
  };

  const handleSubSelect = (sub) => {
    setSelectedSub(sub);
    setStep(3);
  };

  const handleClaimSelect = (claim) => {
    setSelectedClaim(claim);
    setStep(4); // Go to Details Entry
  };

  const handleCustomSubmit = () => {
    if (!customClaimText.trim()) return;
    setSelectedClaim({
        id: 999,
        main: 'أخرى (يدوي)',
        sub: 'غير مصنف',
        claim: 'تصنيف يدوي خاص',
        basis: 'يخضع للتدقيق',
        circuit: 'إحالة للدراسة والمراجعة',
        remedy: 'غير محدد'
    });
    setCaseSubject(customClaimText); // Use the custom text as subject
    setStep(4); // Go to Details Entry (to fill requests/grounds)
  };

  const handleDetailsSubmit = () => {
      if (!caseSubject.trim() || !caseRequests.trim() || !caseGrounds.trim()) {
          alert("يرجى تعبئة جميع الحقول المطلوبة");
          return;
      }
      setStep(5); // Go to Verification
  };

  const handleConfirm = () => {
    setIsProcessing(true);
    setTimeout(() => {
      setIsProcessing(false);
      setStep(6); // Success
    }, 1500);
  };

  const handleBack = () => {
    if (step > 1) {
      if (step === 2) {
          setSelectedMain(null);
          setCustomClaimText('');
      }
      if (step === 3) setSelectedSub(null);
      if (step === 4) setSelectedClaim(null);
      // If going back from 5 (Verification) to 4 (Details), data is preserved in state
      setStep(step - 1);
    }
  };

  const handleReset = () => {
    setStep(1);
    setSelectedMain(null);
    setSelectedSub(null);
    setSelectedClaim(null);
    setCustomClaimText('');
    setCaseSubject('');
    setCaseRequests('');
    setCaseGrounds('');
  };

  // Mock Cases for Operations Dashboard
  // Updated to include the detailed fields
  const pendingCases = [
    { 
        id: 10234, 
        applicant: "محمد عبدالله", 
        category: "إلغاء قرارات إدارية", 
        subject: "إلغاء قرار فصل تعسفي رقم 554 وتاريخ 1445/2/1", 
        requests: "1. إلغاء القرار \n 2. إعادة للخدمة \n 3. صرف الرواتب المتأخرة",
        grounds: "القرار صدر من جهة غير مختصة، ولم يتم التحقيق معي إدارياً قبل الفصل.",
        score: 92, 
        risk: "low", 
        status: "جديد",
        defects: { procedural: "سليم", substantive: "سليم" }
    },
    { 
        id: 10235, 
        applicant: "شركة المقاولات السريعة", 
        category: "عقود إدارية", 
        subject: "عدم صرف مستخلصات نهائية لمشروع صيانة مبنى الوزارة",
        requests: "صرف المستخلص الختامي وقدره 500,000 ريال",
        grounds: "تم تسليم المشروع ابتدائياً ونهائياً بموجب محاضر الاستلام المرفقة.",
        score: 95, 
        risk: "low", 
        status: "جديد",
        defects: { procedural: "سليم", substantive: "سليم" }
    },
    { 
        id: 10236, 
        applicant: "سعيد الزهراني", 
        category: "حقوق وظيفية", 
        subject: "تضررت سيارتي بسبب حفرة في الطريق الدائري", 
        requests: "تعويض مالي قدره 5000 ريال",
        grounds: "تقرير المرور يثبت مسؤولية البلدية عن الحفرة.",
        score: 15, 
        risk: "high", 
        status: "مراجعة",
        defects: { 
            procedural: "سليم", 
            substantive: "احتمالية عدم اختصاص ولائي (مروري/جنائي) أو خطأ في التصنيف (يجب أن تكون مسؤولية تقصيرية/تعويض)" 
        }
    }, 
  ];

  // Icons Helper
  const getCategoryIcon = (category) => {
    if (category.includes('حقوق')) return <Briefcase className="w-8 h-8 text-emerald-700" />;
    if (category.includes('إلغاء')) return <FileX className="w-8 h-8 text-emerald-700" />;
    if (category.includes('عقود')) return <ScrollText className="w-8 h-8 text-emerald-700" />;
    if (category.includes('تعويض')) return <ShieldAlert className="w-8 h-8 text-emerald-700" />;
    if (category.includes('تأديب')) return <Gavel className="w-8 h-8 text-emerald-700" />;
    return <Building2 className="w-8 h-8 text-emerald-700" />;
  };

  return (
    <div dir="rtl" className="min-h-screen bg-gray-50 font-sans text-gray-800">
      {/* Official Top Bar */}
      <div className="bg-emerald-950 text-white py-1 px-4 text-xs flex justify-between items-center">
         <span>بوابة الخدمات الرقمية - نسخة تجريبية</span>
         <button 
            onClick={() => setView(view === 'beneficiary' ? 'operations' : 'beneficiary')}
            className="flex items-center gap-2 bg-emerald-800 hover:bg-emerald-700 px-3 py-1 rounded text-xs transition"
         >
            <ArrowLeftRight className="w-3 h-3" />
            {view === 'beneficiary' ? 'دخول موظفي العمليات' : 'العودة لواجهة المستفيد'}
         </button>
      </div>

      {/* Header */}
      <header className="bg-white border-b-2 border-amber-500 shadow-sm sticky top-0 z-50">
        <div className="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="w-12 h-12 bg-emerald-900 rounded-lg flex items-center justify-center text-amber-500 shadow-sm">
                <Scale className="w-8 h-8" />
            </div>
            <div>
              <h1 className="text-xl md:text-2xl font-bold text-emerald-950 tracking-wide">
                {view === 'beneficiary' ? 'واجهة الدعوى - منصة سمارك لرفع الدعاوى الإدارية بذكاء' : 'مركز عمليات قيد الدعاوى'}
              </h1>
              {view === 'operations' && <span className="text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded-full border border-amber-200">الوصول الإداري</span>}
            </div>
          </div>
          {view === 'beneficiary' && (
            <button onClick={handleReset} className="hidden md:flex items-center gap-2 text-sm text-emerald-700 hover:text-emerald-900 bg-emerald-50 hover:bg-emerald-100 px-4 py-2 rounded-lg transition border border-emerald-200">
                <RefreshCw className="w-4 h-4" />
                طلب جديد
            </button>
          )}
        </div>
      </header>

      <main className="max-w-5xl mx-auto p-4 md:p-8">
        
        {view === 'beneficiary' ? (
            // ================= BENEFICIARY VIEW =================
            <>
                {/* Stepper */}
                <div className="mb-10 max-w-3xl mx-auto">
                <div className="flex justify-between items-center relative">
                    {/* Line */}
                    <div className="absolute top-1/2 left-0 right-0 h-1 bg-gray-200 -z-10 -translate-y-1/2 rounded-full"></div>
                    <div 
                        className="absolute top-1/2 right-0 h-1 bg-emerald-600 -z-10 -translate-y-1/2 rounded-full transition-all duration-700 ease-in-out" 
                        style={{ width: `${((step - 1) / 5) * 100}%` }}
                    ></div>

                    {/* Steps */}
                    {[
                        { n: 1, label: "الغرض" }, 
                        { n: 2, label: "النوع" }, 
                        { n: 3, label: "المطالبة" },
                        { n: 4, label: "التفاصيل" }, 
                        { n: 5, label: "المراجعة" }, 
                        { n: 6, label: "الإحالة" }
                    ].map((s) => (
                        <div key={s.n} className="flex flex-col items-center group">
                            <div className={`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300 ring-4 ring-white
                            ${step >= s.n ? 'bg-emerald-800 text-white shadow-lg scale-100' : 'bg-gray-200 text-gray-400 scale-90'}`}>
                            {step > s.n ? <Check className="w-5 h-5" /> : s.n}
                            </div>
                            <span className={`text-xs mt-2 font-medium transition-colors ${step >= s.n ? 'text-emerald-900' : 'text-gray-400'}`}>
                                {s.label}
                            </span>
                        </div>
                    ))}
                </div>
                </div>

                {/* Main Card Container */}
                <div className="bg-white rounded-xl shadow-lg border border-gray-100 min-h-[500px] p-6 md:p-10 relative overflow-hidden transition-all duration-500">
                
                {/* Back Button */}
                {step > 1 && step < 6 && (
                    <button onClick={handleBack} className="absolute top-6 left-6 text-gray-400 hover:text-emerald-800 flex items-center gap-2 transition-colors z-20 text-sm font-medium">
                        <ChevronLeft className="w-4 h-4" />
                        رجوع للسابق
                    </button>
                )}

                {/* Step 1: Main Categories */}
                {step === 1 && (
                    <div className="animate-fade-in">
                    <div className="text-center mb-10">
                        <h2 className="text-2xl font-bold text-emerald-950 mb-3">الغرض الأساسي للدعوى</h2>
                        <p className="text-gray-500">فضلاً قم باختيار التصنيف الرئيسي الذي تندرج تحته دعواك</p>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in">
                        {mainCategories.map((category) => (
                        <button
                            key={category}
                            onClick={() => handleMainSelect(category)}
                            className="flex flex-col items-center p-6 border border-gray-100 rounded-xl hover:border-emerald-500 hover:shadow-xl hover:bg-emerald-50/10 transition-all group bg-white shadow-sm relative overflow-hidden"
                        >
                            <div className="absolute inset-x-0 bottom-0 h-1 bg-emerald-500 scale-x-0 group-hover:scale-x-100 transition-transform origin-right"></div>
                            <div className="p-4 bg-emerald-50 rounded-full mb-5 group-hover:bg-emerald-100 transition-colors">
                            {getCategoryIcon(category)}
                            </div>
                            <span className="font-bold text-lg text-emerald-950 mb-2">{category}</span>
                            <span className="text-xs text-gray-400 group-hover:text-emerald-600">اضغط للمتابعة</span>
                        </button>
                        ))}
                        
                        {/* Custom "Other" Option */}
                        <button
                            onClick={() => handleMainSelect('أخرى')}
                            className="flex flex-col items-center p-6 border-2 border-dashed border-gray-200 rounded-xl hover:border-amber-400 hover:shadow-lg hover:bg-amber-50/10 transition-all group bg-gray-50/50"
                            >
                            <div className="p-4 bg-gray-100 rounded-full text-gray-500 mb-5 group-hover:bg-amber-100 group-hover:text-amber-600 transition-colors">
                            <PenTool className="w-8 h-8" />
                            </div>
                            <span className="font-bold text-lg text-gray-600 group-hover:text-amber-800">أخرى (كتابة يدوية)</span>
                            <span className="text-xs text-gray-400 mt-2 text-center">في حال عدم توفر التصنيف المناسب</span>
                            </button>
                    </div>
                    </div>
                )}

                {/* Step 2: Sub Categories OR Custom Input */}
                {step === 2 && (
                    <div className="animate-fade-in">
                    {selectedMain === 'أخرى' ? (
                        // --- Custom Input UI ---
                        <div className="max-w-2xl mx-auto">
                            <div className="text-center mb-8">
                                <h2 className="text-2xl font-bold text-emerald-950 mb-3">وصف نوع الدعوى</h2>
                                <p className="text-gray-500">حاول وصف نوع القضية بشكل عام لتحديد المسار</p>
                            </div>
                            
                            <div className="mb-6 bg-gray-50 p-6 rounded-xl border border-gray-200 relative">
                                <label className="block text-sm font-bold text-emerald-900 mb-3">نوع القضية:</label>
                                <textarea 
                                    value={customClaimText}
                                    onChange={(e) => setCustomClaimText(e.target.value)}
                                    placeholder="مثال: مطالبة مالية لجهة حكومية..."
                                    className="w-full h-32 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none resize-none text-gray-700 bg-white leading-relaxed shadow-inner"
                                ></textarea>
                            </div>

                            <button 
                                onClick={handleCustomSubmit}
                                disabled={!customClaimText.trim()}
                                className={`w-full py-4 rounded-lg font-bold flex items-center justify-center gap-2 transition-all shadow-md ${
                                    customClaimText.trim() 
                                    ? 'bg-emerald-900 hover:bg-emerald-800 text-white hover:shadow-lg' 
                                    : 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                }`}
                            >
                                متابعة لكتابة التفاصيل
                                <ArrowRight className="w-5 h-5 rtl:rotate-180" />
                            </button>
                        </div>
                    ) : (
                        // --- Standard Sub-Categories UI ---
                        <div className="max-w-4xl mx-auto">
                            <div className="text-center mb-10">
                                <h2 className="text-2xl font-bold text-emerald-950 mb-2">تصنيف {selectedMain}</h2>
                                <p className="text-gray-500">حدد النوع الفرعي للدعوى</p>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {subCategories.map((sub) => (
                                <button
                                    key={sub}
                                    onClick={() => handleSubSelect(sub)}
                                    className="flex items-center p-5 border border-gray-200 rounded-xl hover:border-emerald-600 hover:bg-emerald-50/30 transition-all group bg-white text-right shadow-sm hover:shadow-md"
                                >
                                    <div className="ml-4 p-3 bg-gray-50 rounded-lg group-hover:bg-emerald-100 transition-colors">
                                        <div className="text-gray-500 group-hover:text-emerald-700">
                                        <FileCheck className="w-6 h-6" />
                                        </div>
                                    </div>
                                    <div>
                                        <span className="block font-bold text-lg text-gray-800 group-hover:text-emerald-900">{sub}</span>
                                        <span className="text-xs text-gray-400 group-hover:text-emerald-600">انقر لعرض المواضيع المتاحة</span>
                                    </div>
                                    <div className="mr-auto opacity-0 group-hover:opacity-100 transition-opacity">
                                        <ArrowRight className="w-5 h-5 text-emerald-500 rtl:rotate-180" />
                                    </div>
                                </button>
                                ))}
                            </div>
                        </div>
                    )}
                    </div>
                )}

                {/* Step 3: Specific Claims List */}
                {step === 3 && selectedMain !== 'أخرى' && (
                    <div className="animate-fade-in max-w-4xl mx-auto">
                    <div className="text-center mb-10">
                        <h2 className="text-2xl font-bold text-emerald-950 mb-2">تحديد موضوع الدعوى الدقيق</h2>
                        <p className="text-gray-500">اختر الموضوع الأدق من القائمة التالية</p>
                    </div>

                    <div className="grid grid-cols-1 gap-3 max-h-[450px] overflow-y-auto custom-scrollbar p-2 border border-gray-100 rounded-xl bg-gray-50">
                        {specificClaims.map((item) => (
                        <button
                            key={item.id}
                            onClick={() => handleClaimSelect(item)}
                            className="flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg hover:border-emerald-500 hover:shadow-md transition-all group text-right"
                        >
                            <div className="flex items-center gap-3">
                                <div className="w-2 h-2 bg-gray-300 rounded-full group-hover:bg-emerald-500 transition-colors"></div>
                                <span className="font-medium text-gray-700 group-hover:text-emerald-900">{item.claim}</span>
                            </div>
                            <span className="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded group-hover:bg-emerald-100 group-hover:text-emerald-700 transition-colors">اختيار</span>
                        </button>
                        ))}
                    </div>
                    </div>
                )}

                {/* Step 4: Details Form (Subject, Requests, Grounds) */}
                {step === 4 && (
                    <div className="animate-fade-in max-w-3xl mx-auto">
                        <div className="text-center mb-8">
                            <h2 className="text-2xl font-bold text-emerald-950 mb-2">تفاصيل وصحيفة الدعوى</h2>
                            <p className="text-gray-500">يرجى كتابة تفاصيل الدعوى بوضوح لضمان دقة القيد</p>
                        </div>

                        <div className="space-y-6">
                            {/* Subject */}
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                                <label className="flex items-center gap-2 font-bold text-emerald-900 mb-3">
                                    <FileText className="w-5 h-5"/>
                                    موضوع الدعوى
                                    <span className="text-xs font-normal text-gray-400">(بلغة مبسطة وواضحة)</span>
                                </label>
                                <textarea 
                                    value={caseSubject}
                                    onChange={(e) => setCaseSubject(e.target.value)}
                                    placeholder="أكتب موضوع الدعوى هنا..."
                                    className="w-full h-24 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none resize-none text-gray-700"
                                ></textarea>
                            </div>

                            {/* Requests */}
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                                <label className="flex items-center gap-2 font-bold text-emerald-900 mb-3">
                                    <List className="w-5 h-5"/>
                                    الطلبات
                                    <span className="text-xs font-normal text-gray-400">(ماذا تطلب من المحكمة؟)</span>
                                </label>
                                <textarea 
                                    value={caseRequests}
                                    onChange={(e) => setCaseRequests(e.target.value)}
                                    placeholder="1. إلغاء القرار... &#10;2. التعويض..."
                                    className="w-full h-24 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none resize-none text-gray-700"
                                ></textarea>
                            </div>

                            {/* Grounds */}
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                                <label className="flex items-center gap-2 font-bold text-emerald-900 mb-3">
                                    <BookOpen className="w-5 h-5"/>
                                    الأسانيد
                                    <span className="text-xs font-normal text-gray-400">(المبررات والأدلة النظامية)</span>
                                </label>
                                <textarea 
                                    value={caseGrounds}
                                    onChange={(e) => setCaseGrounds(e.target.value)}
                                    placeholder="استناداً للمادة رقم... وحيث أن..."
                                    className="w-full h-24 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none resize-none text-gray-700"
                                ></textarea>
                            </div>

                            <button 
                                onClick={handleDetailsSubmit}
                                className="w-full bg-emerald-900 hover:bg-emerald-800 text-white font-bold py-4 px-8 rounded-lg shadow-lg hover:shadow-emerald-900/30 transition-all flex items-center justify-center gap-3"
                            >
                                مراجعة الطلب
                                <ArrowRight className="w-5 h-5 rtl:rotate-180" />
                            </button>
                        </div>
                    </div>
                )}

                {/* Step 5: Verification Card */}
                {step === 5 && (
                    <div className="animate-fade-in flex flex-col items-center max-w-3xl mx-auto">
                    <div className="text-center mb-8">
                        <h2 className="text-2xl font-bold text-emerald-950 mb-2">مراجعة البيانات النهائية</h2>
                        <p className="text-gray-500">يرجى التأكد من صحة البيانات قبل الإحالة النهائية</p>
                    </div>

                    <div className="w-full bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden mb-8">
                        <div className={`h-2 w-full ${selectedMain === 'أخرى' ? 'bg-amber-500' : 'bg-emerald-600'}`}></div>
                        <div className="p-6 md:p-8 space-y-6">
                        
                        {/* Classification Section */}
                        <div className="flex items-start gap-4">
                            <div className="p-2 bg-gray-100 rounded-lg text-gray-500">
                                <Building2 className="w-5 h-5" />
                            </div>
                            <div>
                                <span className="text-xs font-bold text-gray-400 uppercase tracking-wider block mb-1">التصنيف</span>
                                <p className="text-lg font-bold text-gray-800">{selectedMain} {selectedSub ? ` - ${selectedSub}` : ''}</p>
                                <p className="text-sm text-emerald-700 mt-1">{selectedClaim?.claim}</p>
                            </div>
                        </div>

                        <div className="border-t border-gray-100 my-4"></div>

                        {/* Details Section */}
                        <div className="space-y-4">
                            <div>
                                <h4 className="text-sm font-bold text-gray-500 mb-1">موضوع الدعوى</h4>
                                <p className="text-gray-800 bg-gray-50 p-3 rounded-lg text-sm leading-relaxed">{caseSubject}</p>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h4 className="text-sm font-bold text-gray-500 mb-1">الطلبات</h4>
                                    <p className="text-gray-800 bg-gray-50 p-3 rounded-lg text-sm leading-relaxed whitespace-pre-line">{caseRequests}</p>
                                </div>
                                <div>
                                    <h4 className="text-sm font-bold text-gray-500 mb-1">الأسانيد</h4>
                                    <p className="text-gray-800 bg-gray-50 p-3 rounded-lg text-sm leading-relaxed whitespace-pre-line">{caseGrounds}</p>
                                </div>
                            </div>
                        </div>

                        </div>
                    </div>

                    <button 
                        onClick={handleConfirm}
                        className="w-full bg-emerald-900 hover:bg-emerald-800 text-white font-bold py-4 px-8 rounded-lg shadow-lg hover:shadow-emerald-900/30 transition-all flex items-center justify-center gap-3"
                    >
                        اعتماد وإحالة الطلب
                        <FileCheck className="w-5 h-5" />
                    </button>
                    </div>
                )}

                {/* Step 6: Final Success */}
                {step === 6 && (
                    <div className="animate-scale-in text-center py-4">
                    <div className="inline-flex items-center justify-center w-20 h-20 bg-emerald-100 rounded-full mb-6 ring-8 ring-emerald-50">
                        <Gavel className="w-10 h-10 text-emerald-700" />
                    </div>
                    <h2 className="text-3xl font-bold text-emerald-950 mb-2">تمت الإحالة بنجاح</h2>
                    <p className="text-gray-500 mb-8 max-w-md mx-auto">تم قيد الطلب وتوجيهه إلى الدائرة المختصة آلياً.</p>

                    {/* Official Ticket Design */}
                    <div className="bg-white border border-gray-300 rounded-sm shadow-xl max-w-lg mx-auto overflow-hidden text-right relative ticket-pattern">
                        {/* Decorative Top Border */}
                        <div className="h-2 bg-gradient-to-r from-emerald-800 via-emerald-600 to-emerald-800"></div>
                        
                        <div className="px-8 py-6 border-b border-gray-200 flex justify-between items-start bg-gray-50/50">
                        <div>
                            <h3 className="font-bold text-emerald-900 text-lg mb-1">بطاقة توجيه دعوى</h3>
                            <p className="text-xs text-gray-500">نظام إدارة القضايا - ديوان المظالم</p>
                        </div>
                        <div className="text-center">
                            <span className="block text-xs text-gray-400 mb-1">رقم الإحالة</span>
                            <span className="font-mono font-bold text-lg text-emerald-800 tracking-widest">{selectedClaim?.id.toString().padStart(6, '0')}</span>
                        </div>
                        </div>
                        
                        <div className="p-8 space-y-6 bg-white relative">
                        {/* Watermark */}
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 opacity-[0.03] pointer-events-none">
                            <Scale className="w-64 h-64" />
                        </div>

                        <div className="grid grid-cols-1 gap-6 relative z-10">
                            <div>
                                <span className="text-gray-400 text-xs font-bold block mb-1">الدائرة القضائية المختصة</span>
                                <p className="text-lg font-bold text-emerald-950 border-b border-gray-100 pb-2">{selectedClaim?.circuit}</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-6 relative z-10">
                            <div>
                                <span className="text-gray-400 text-xs font-bold block mb-1">السند النظامي</span>
                                <div className="inline-block bg-gray-100 border border-gray-200 px-3 py-1 rounded text-sm font-medium text-gray-700">
                                    {selectedClaim?.basis}
                                </div>
                            </div>
                            <div>
                                <span className="text-gray-400 text-xs font-bold block mb-1">التصنيف الإجرائي</span>
                                <p className={`font-bold text-sm ${selectedMain === 'أخرى' ? 'text-amber-600' : 'text-emerald-700'}`}>
                                    {selectedClaim?.remedy}
                                </p>
                            </div>
                        </div>
                        </div>

                        <div className="bg-gray-50 px-8 py-4 border-t border-gray-200 flex justify-between items-center print:hidden">
                        <button onClick={() => window.print()} className="text-gray-500 hover:text-gray-700 text-xs font-medium flex items-center gap-1">
                            <ScrollText className="w-4 h-4" />
                            طباعة البطاقة
                        </button>
                        <button onClick={handleReset} className="text-emerald-700 hover:text-emerald-900 text-sm font-bold">
                            إغلاق
                        </button>
                        </div>
                    </div>
                    </div>
                )}

                {/* Processing Overlay */}
                {isProcessing && (
                    <div className="absolute inset-0 bg-white/90 z-50 flex flex-col items-center justify-center backdrop-blur-sm">
                    <div className="relative">
                        <div className="w-16 h-16 border-4 border-emerald-100 rounded-full"></div>
                        <div className="w-16 h-16 border-4 border-emerald-600 rounded-full border-t-transparent animate-spin absolute top-0 left-0"></div>
                    </div>
                    <p className="text-lg font-bold text-emerald-900 mt-6 animate-pulse">جاري معالجة الطلب...</p>
                    <p className="text-sm text-gray-500 mt-2">يرجى عدم إغلاق الصفحة</p>
                    </div>
                )}
                </div>
            </>
        ) : (
            // ================= OPERATIONS CENTER VIEW =================
            <div className="animate-fade-in">
                {opStep === 'dashboard' ? (
                    <>
                        <h2 className="text-2xl font-bold text-emerald-950 mb-6 flex items-center gap-2">
                            <MonitorCheck className="w-6 h-6 text-emerald-600" />
                            طلبات التدقيق الواردة
                        </h2>
                        
                        <div className="grid grid-cols-1 gap-4">
                            {pendingCases.map(c => (
                                <div key={c.id} className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition flex justify-between items-center">
                                    <div>
                                        <div className="flex items-center gap-3 mb-2">
                                            <span className="font-mono text-gray-400 text-sm">#{c.id}</span>
                                            <h3 className="font-bold text-lg text-gray-800">{c.subject}</h3>
                                        </div>
                                        <div className="flex items-center gap-4 text-sm text-gray-500">
                                            <span className="flex items-center gap-1"><UserCheck className="w-4 h-4"/> {c.applicant}</span>
                                            <span className="bg-gray-100 px-2 py-0.5 rounded text-gray-700">{c.category}</span>
                                        </div>
                                    </div>
                                    <div className="text-center min-w-[120px]">
                                        <div className={`text-2xl font-bold mb-1 ${c.score > 80 ? 'text-emerald-600' : 'text-red-500'}`}>
                                            {c.score}%
                                        </div>
                                        <div className="text-xs text-gray-400">نسبة المطابقة</div>
                                        <button 
                                            onClick={() => {setSelectedCase(c); setOpStep('review');}}
                                            className="mt-3 text-sm bg-emerald-50 text-emerald-700 hover:bg-emerald-100 px-4 py-1.5 rounded-lg w-full font-bold transition"
                                        >
                                            مراجعة
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </>
                ) : (
                    // Review Screen
                    <div className="max-w-4xl mx-auto">
                        <button onClick={() => setOpStep('dashboard')} className="mb-4 text-gray-500 hover:text-gray-800 flex items-center gap-1 text-sm">
                            <ChevronLeft className="w-4 h-4" /> عودة للقائمة
                        </button>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            {/* Main Case Info */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Details Card */}
                                <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                                    <h3 className="font-bold text-lg text-emerald-950 mb-4 border-b pb-2">بيانات الدعوى المدخلة</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="text-xs text-gray-400 block mb-1">التصنيف المختار من المستفيد</label>
                                            <p className="text-emerald-700 font-bold bg-emerald-50 inline-block px-3 py-1 rounded">{selectedCase?.category}</p>
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-400 block mb-1">الموضوع</label>
                                            <p className="text-gray-800 font-medium bg-gray-50 p-2 rounded">{selectedCase?.subject}</p>
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-400 block mb-1">الطلبات</label>
                                            <p className="text-gray-800 text-sm whitespace-pre-line bg-gray-50 p-2 rounded">{selectedCase?.requests}</p>
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-400 block mb-1">الأسانيد</label>
                                            <p className="text-gray-800 text-sm whitespace-pre-line bg-gray-50 p-2 rounded">{selectedCase?.grounds}</p>
                                        </div>
                                    </div>
                                </div>

                                {/* AI Analysis */}
                                <div className="bg-slate-50 p-6 rounded-xl border border-slate-200">
                                    <div className="flex items-center gap-2 mb-4">
                                        <FileSearch className="w-5 h-5 text-purple-600" />
                                        <h3 className="font-bold text-lg text-slate-800">تحليل الذكاء الاصطناعي</h3>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        {/* Accuracy */}
                                        <div className="bg-white p-4 rounded-lg border border-slate-200">
                                            <div className="flex justify-between items-center mb-2">
                                                <span className="text-sm font-bold text-gray-600">دقة التصنيف</span>
                                                <span className={`font-bold ${selectedCase?.score > 80 ? 'text-green-600' : 'text-red-500'}`}>{selectedCase?.score}%</span>
                                            </div>
                                            <div className="h-2 bg-gray-100 rounded-full overflow-hidden">
                                                <div className={`h-full ${selectedCase?.score > 80 ? 'bg-green-500' : 'bg-red-500'}`} style={{width: `${selectedCase?.score}%`}}></div>
                                            </div>
                                            {selectedCase?.score < 50 && (
                                                <div className="mt-2 text-xs text-red-600 flex items-center gap-1 bg-red-50 p-2 rounded">
                                                    <AlertOctagon className="w-3 h-3" />
                                                    يوجد تعارض كبير بين الموضوع والتصنيف المختار.
                                                </div>
                                            )}
                                        </div>

                                        {/* Procedural Check */}
                                        <div className="bg-white p-4 rounded-lg border border-slate-200 flex items-start gap-3">
                                            <div className="bg-green-100 p-2 rounded-full text-green-600"><CheckCircle2 className="w-5 h-5"/></div>
                                            <div>
                                                <h4 className="font-bold text-sm text-gray-800">الشروط الشكلية (Procedural Requirements)</h4>
                                                <p className="text-xs text-gray-500 mt-1">{selectedCase?.defects?.procedural}</p>
                                            </div>
                                        </div>

                                        {/* Substantive Check */}
                                        <div className="bg-white p-4 rounded-lg border border-slate-200 flex items-start gap-3">
                                            <div className={`${selectedCase?.score < 50 ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'} p-2 rounded-full`}>
                                                {selectedCase?.score < 50 ? <XCircle className="w-5 h-5"/> : <CheckCircle2 className="w-5 h-5"/>}
                                            </div>
                                            <div>
                                                <h4 className="font-bold text-sm text-gray-800">الشروط الموضوعية (Substantive Requirements)</h4>
                                                <p className="text-xs text-gray-500 mt-1">{selectedCase?.defects?.substantive}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Actions Column */}
                            <div className="space-y-4">
                                <div className="bg-white p-5 rounded-xl border border-gray-200 shadow-sm h-full flex flex-col">
                                    <h3 className="font-bold text-gray-800 mb-6">القرار النهائي</h3>
                                    
                                    {selectedCase?.score < 50 && (
                                        <button className="mb-4 bg-amber-50 hover:bg-amber-100 text-amber-700 border border-amber-200 py-3 px-4 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition">
                                            <RefreshCw className="w-4 h-4" />
                                            تعديل مسار الدعوى
                                        </button>
                                    )}

                                    <div className="mt-auto space-y-3">
                                        <button onClick={() => setOpStep('dashboard')} className="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-3 rounded-lg font-bold shadow-md transition flex items-center justify-center gap-2">
                                            <Check className="w-5 h-5" />
                                            قبول القيد والإحالة
                                        </button>
                                        <button onClick={() => setOpStep('dashboard')} className="w-full bg-white hover:bg-red-50 text-red-600 border border-red-200 py-3 rounded-lg font-bold transition">
                                            رفض / إعادة للمستفيد
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                )}
            </div>
        )}

      </main>

      <style>{`
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f1f5f9;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #cbd5e1;
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #94a3b8;
        }
        @keyframes fade-in {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
          animation: fade-in 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        @keyframes scale-in {
          from { opacity: 0; transform: scale(0.95); }
          to { opacity: 1; transform: scale(1); }
        }
        .animate-scale-in {
           animation: scale-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        .ticket-pattern {
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }
      `}</style>
    </div>
  );
};

export default App;